<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title th:text="${libro?.id != null} ? 'Editar Libro' : 'Nuevo Libro'">Formulario Libro</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <style>
    .form-container {
      max-width: 800px;
    }
    .card {
      border: none;
      border-radius: 10px;
      box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    .form-control:focus, .form-select:focus {
      border-color: #0d6efd;
      box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }
    .btn-submit {
      background-color: #198754;
      border: none;
      padding: 0.75rem;
      font-weight: 600;
      transition: all 0.3s;
    }
    .btn-submit:hover {
      background-color: #146c43;
      transform: translateY(-2px);
    }
  </style>
</head>
<body class="bg-light">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container">
      <a class="navbar-brand" th:href="@{/}">
        <i class="bi bi-book-half"></i> Sistema de Biblioteca
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
              aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" th:href="@{/}">Inicio</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" th:href="@{/libros}">Libros</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="#">Formulario Libro</a>
          </li>
        </ul>
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" th:href="@{/usuario/perfil}">
              <i class="bi bi-person-circle"></i> Mi Perfil
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container form-container">
    <div class="row justify-content-center">
      <div class="col-12">
        <div class="card">
          <div class="card-header bg-primary text-white">
            <h2 class="h5 mb-0">
              <i class="bi" th:classappend="${libro?.id != null} ? 'bi-pencil-square' : 'bi-plus-circle'" 
                 th:text="${libro?.id != null} ? ' Editar Libro' : ' Nuevo Libro'"></i>
            </h2>
          </div>
          <div class="card-body p-4">
            <!-- Mensajes flash -->
            <div th:if="${success != null}" class="alert alert-success alert-dismissible fade show" role="alert">
              <i class="bi bi-check-circle-fill me-2"></i>
              <span th:text="${success}"></span>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <div th:if="${error != null}" class="alert alert-danger alert-dismissible fade show" role="alert">
              <i class="bi bi-exclamation-triangle-fill me-2"></i>
              <span th:text="${error}"></span>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>

            <form th:action="@{/libros}" th:object="${libro}" method="post" novalidate>
              <!-- CSRF -->
              <input type="hidden" th:if="${_csrf}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
              <input type="hidden" th:field="*{id}"/>

              <div class="row">
                <div class="col-md-8 mb-3">
                  <label for="titulo" class="form-label fw-bold">Título <span class="text-danger">*</span></label>
                  <input type="text" id="titulo" class="form-control form-control-lg" th:field="*{titulo}" 
                         required maxlength="200" placeholder="Ingresa el título del libro"/>
                  <div class="text-danger small" th:if="${#fields.hasErrors('titulo')}" th:errors="*{titulo}"></div>
                </div>

                <div class="col-md-4 mb-3">
                  <label for="unidades" class="form-label fw-bold">Unidades <span class="text-danger">*</span></label>
                  <input type="number" id="unidades" class="form-control form-control-lg" th:field="*{unidades}" 
                         required min="0" placeholder="0"/>
                  <div class="text-danger small" th:if="${#fields.hasErrors('unidades')}" th:errors="*{unidades}"></div>
                </div>
              </div>

              <div class="mb-3">
                <label for="isbn" class="form-label fw-bold">ISBN</label>
                <input type="text" id="isbn" class="form-control" th:field="*{isbn}" 
                       maxlength="20" placeholder="Ingresa el ISBN del libro"/>
                <div class="text-danger small" th:if="${#fields.hasErrors('isbn')}" th:errors="*{isbn}"></div>
              </div>

              <div class="mb-3">
                <label for="anioPublicacion" class="form-label fw-bold">Año de Publicación</label>
                <input type="number" id="anioPublicacion" class="form-control" th:field="*{anioPublicacion}" 
                       min="1000" max="2025" placeholder="Ej: 2020"/>
                <div class="text-danger small" th:if="${#fields.hasErrors('anioPublicacion')}" th:errors="*{anioPublicacion}"></div>
              </div>

              <div class="mb-3">
                <label for="descripcion" class="form-label fw-bold">Descripción</label>
                <textarea id="descripcion" class="form-control" th:field="*{descripcion}" 
                          rows="3" placeholder="Breve descripción del libro" maxlength="500"></textarea>
                <div class="form-text"><span id="descripcionContador">0</span>/500 caracteres</div>
                <div class="text-danger small" th:if="${#fields.hasErrors('descripcion')}" th:errors="*{descripcion}"></div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="autores" class="form-label fw-bold">Autores <span class="text-danger">*</span></label>
                  <select id="autores" class="form-select" th:field="*{autores}" multiple size="5" required>
                    <option th:each="a : ${autores}" th:value="${a.id}"
                            th:text="${a.nombre + ' (' + a.pais + ')'}"></option>
                  </select>
                  <div class="form-text">Mantén presionada la tecla Ctrl (Windows) o Command (Mac) para seleccionar varios autores.</div>
                  <div class="text-danger small" th:if="${#fields.hasErrors('autores')}" th:errors="*{autores}"></div>
                </div>

                <div class="col-md-6 mb-3"> 
                  <label for="categoria" class="form-label fw-bold">Categoría <span class="text-danger">*</span></label>
                  <select id="categoria" class="form-select" th:field="*{categoria}" required>
                    <option value="" disabled selected>-- Selecciona una categoría --</option>
                    <option th:each="c : ${categorias}" th:value="${c.id}" th:text="${c.nombre}"></option>
                  </select>
                  <div class="text-danger small" th:if="${#fields.hasErrors('categoria')}" th:errors="*{categoria}"></div>
                </div>
              </div>

              <div class="d-flex justify-content-between mt-4">
                <a th:href="@{/libros}" class="btn btn-outline-secondary">
                  <i class="bi bi-arrow-left me-1"></i> Volver al Listado
                </a>
                <button type="submit" class="btn btn-submit">
                  <i class="bi" th:classappend="${libro?.id != null} ? 'bi-check-circle' : 'bi-save'"></i>
                  <span th:text="${libro?.id != null} ? ' Actualizar Libro' : ' Guardar Libro'"></span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-dark text-white py-4 mt-5">
    <div class="container">
      <div class="row">
        <div class="col-md-8">
          <h5>Sistema de Gestión de Biblioteca</h5>
          <p>Gestiona tu catálogo de libros de manera eficiente.</p>
        </div>
        <div class="col-md-4">
          <h5>Contacto</h5>
          <address class="small mb-0">
            <i class="bi bi-geo-alt"></i> Tibas Colima<br>
            <i class="bi bi-envelope"></i> cardiaz24@hotmail.com<br>
            <i class="bi bi-telephone"></i> 506 70176506
          </address>
        </div>
      </div>
      <hr>
      <p class="text-center mb-0 small">&copy; 2025 Sistema de Gestión de Biblioteca. Todos los derechos reservados.</p>
    </div>
  </footer>

  <script>
    // Contador de caracteres para la descripción
    document.addEventListener('DOMContentLoaded', function() {
      const descripcion = document.getElementById('descripcion');
      const contador = document.getElementById('descripcionContador');
      
      if (descripcion && contador) {
        // Establecer el valor inicial
        contador.textContent = descripcion.value.length;
        
        // Actualizar el contador mientras se escribe
        descripcion.addEventListener('input', function() {
          contador.textContent = this.value.length;
        });
      }
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>